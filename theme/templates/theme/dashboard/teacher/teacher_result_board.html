{% extends "theme/dashboard_layout.html" %}
{% load static %}

{% block title %}GRES | Profile{% endblock %}

{% block content %}


 <div class="bg-gradient-to-r from-blue-500 to-blue-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-white">Result Board</h1>
                    <p class="text-blue-100 mt-2">Add, edit, and manage student results</p>
                </div>
                <div class="flex items-center text-white">
                    <i class="fas fa-chart-bar text-2xl mr-3"></i>
                    <div class="text-right">
                        <p class="text-sm text-blue-100">Pending Results</p>
                        <p class="text-2xl font-bold">8</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Action Tabs -->
        <div class="bg-white shadow-sm rounded-lg mb-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex">
                    <button onclick="switchTab('add')" id="addTab" class="w-1/3 py-4 px-6 text-center border-b-2 border-blue-500 text-blue-600 font-medium text-sm">
                        <i class="fas fa-plus mr-2"></i>Add Results
                    </button>
                    <button onclick="switchTab('view')" id="viewTab" class="w-1/3 py-4 px-6 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                        <i class="fas fa-eye mr-2"></i>View Results
                    </button>
                    <button onclick="switchTab('bulk')" id="bulkTab" class="w-1/3 py-4 px-6 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                        <i class="fas fa-upload mr-2"></i>Bulk Upload
                    </button>
                </nav>
            </div>
        </div>

        <!-- Add Results Tab -->
        <div id="addResultsContent" class="tab-content">
            <div class="bg-white shadow-sm rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Add Student Results</h3>
                </div>
                
                <div class="p-6">
                    <!-- Selection Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Class</label>
                            <select id="classSelect" onchange="loadStudents()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Class</option>
                                <option value="10A">Class 10A</option>
                                <option value="10B">Class 10B</option>
                                <option value="11A">Class 11A</option>
                                <option value="11B">Class 11B</option>
                                <option value="12A">Class 12A</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                            <select id="subjectSelect" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Subject</option>
                                <option value="MATH101">Mathematics</option>
                                <option value="PHY201">Physics</option>
                                <option value="CHEM301">Chemistry</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Term</label>
                            <select id="termSelect" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Term</option>
                                <option value="1st">1st Term</option>
                                <option value="2nd">2nd Term</option>
                                <option value="3rd">3rd Term</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Session</label>
                            <select id="sessionSelect" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Session</option>
                                <option value="2023/2024">2023/2024</option>
                                <option value="2024/2025">2024/2025</option>
                                <option value="2025/2026">2025/2026</option>
                            </select>
                        </div>
                    </div>

                    <!-- Students Results Table -->
                    <div id="studentsTable" class="hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-md font-medium text-gray-900">Enter Student Scores</h4>
                            <div class="flex space-x-2">
                                <button onclick="saveResults()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    <i class="fas fa-save mr-2"></i>Save Results
                                </button>
                                <button onclick="lockResults()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    <i class="fas fa-lock mr-2"></i>Lock Results
                                </button>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test Score (30)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Exam Score (70)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total (100)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grade</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Remark</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <img class="h-8 w-8 rounded-full" src="https://via.placeholder.com/32x32/3B82F6/FFFFFF?text=AS" alt="">
                                                <div class="ml-3">
                                                    <div class="text-sm font-medium text-gray-900">Alice Smith</div>
                                                    <div class="text-sm text-gray-500">STU001</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <input type="number" max="30" min="0" placeholder="0" onchange="calculateTotal(this)" class="w-20 border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <input type="number" max="70" min="0" placeholder="0" onchange="calculateTotal(this)" class="w-20 border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm font-medium text-gray-900 total-score">0</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="grade-badge inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">-</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm text-gray-500 remark">-</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <img class="h-8 w-8 rounded-full" src="https://via.placeholder.com/32x32/10B981/FFFFFF?text=BJ" alt="">
                                                <div class="ml-3">
                                                    <div class="text-sm font-medium text-gray-900">Bob Johnson</div>
                                                    <div class="text-sm text-gray-500">STU002</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <input type="number" max="30" min="0" placeholder="0" onchange="calculateTotal(this)" class="w-20 border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <input type="number" max="70" min="0" placeholder="0" onchange="calculateTotal(this)" class="w-20 border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm font-medium text-gray-900 total-score">0</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="grade-badge inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">-</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="text-sm text-gray-500 remark">-</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Results Tab -->
        <div id="viewResultsContent" class="tab-content hidden">
            <div class="bg-white shadow-sm rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">View Previous Results</h3>
                        <div class="flex space-x-2">
                            <select class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">All Classes</option>
                                <option value="10A">Class 10A</option>
                                <option value="10B">Class 10B</option>
                                <option value="11A">Class 11A</option>
                            </select>
                            <select class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">All Subjects</option>
                                <option value="MATH101">Mathematics</option>
                                <option value="PHY201">Physics</option>
                                <option value="CHEM301">Chemistry</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="p-6">
                    <div class="space-y-4">
                        <!-- Result Entry Card -->
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h4 class="text-md font-medium text-gray-900">Mathematics - Class 10A</h4>
                                    <p class="text-sm text-gray-500">2nd Term 2024/2025 • Uploaded 2 days ago</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-lock mr-1"></i>Locked
                                    </span>
                                    <button onclick="viewResultDetails('MATH101', '10A')" class="text-blue-600 hover:text-blue-700 text-sm">
                                        <i class="fas fa-eye mr-1"></i>View
                                    </button>
                                    <button class="text-green-600 hover:text-green-700 text-sm">
                                        <i class="fas fa-edit mr-1"></i>Edit
                                    </button>
                                    <button class="text-red-600 hover:text-red-700 text-sm" onclick="deleteResult('MATH101', '10A')">
                                        <i class="fas fa-trash mr-1"></i>Delete
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-4 gap-4 text-sm">
                                <div class="text-center p-2 bg-gray-50 rounded">
                                    <p class="font-medium text-gray-900">25</p>
                                    <p class="text-gray-500">Students</p>
                                </div>
                                <div class="text-center p-2 bg-gray-50 rounded">
                                    <p class="font-medium text-gray-900">85.2%</p>
                                    <p class="text-gray-500">Average</p>
                                </div>
                                <div class="text-center p-2 bg-gray-50 rounded">
                                    <p class="font-medium text-gray-900">22</p>
                                    <p class="text-gray-500">Passed</p>
                                </div>
                                <div class="text-center p-2 bg-gray-50 rounded">
                                    <p class="font-medium text-gray-900">3</p>
                                    <p class="text-gray-500">Failed</p>
                                </div>
                            </div>
                        </div>

                        <!-- Result Entry Card -->
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h4 class="text-md font-medium text-gray-900">Physics - Class 11A</h4>
                                    <p class="text-sm text-gray-500">2nd Term 2024/2025 • Uploaded 5 days ago</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        <i class="fas fa-unlock mr-1"></i>Unlocked
                                    </span>
                                    <button onclick="viewResultDetails('PHY201', '11A')" class="text-blue-600 hover:text-blue-700 text-sm">
                                        <i class="fas fa-eye mr-1"></i>View
                                    </button>
                                    <button class="text-green-600 hover:text-green-700 text-sm">
                                        <i class="fas fa-edit mr-1"></i>Edit
                                    </button>
                                    <button class="text-red-600 hover:text-red-700 text-sm" onclick="deleteResult('PHY201', '11A')">
                                        <i class="fas fa-trash mr-1"></i>Delete
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-4 gap-4 text-sm">
                                <div class="text-center p-2 bg-gray-50 rounded">
                                    <p class="font-medium text-gray-900">18</p>
                                    <p class="text-gray-500">Students</p>
                                </div>
                                <div class="text-center p-2 bg-gray-50 rounded">
                                    <p class="font-medium text-gray-900">78.5%</p>
                                    <p class="text-gray-500">Average</p>
                                </div>
                                <div class="text-center p-2 bg-gray-50 rounded">
                                    <p class="font-medium text-gray-900">15</p>
                                    <p class="text-gray-500">Passed</p>
                                </div>
                                <div class="text-center p-2 bg-gray-50 rounded">
                                    <p class="font-medium text-gray-900">3</p>
                                    <p class="text-gray-500">Failed</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Upload Tab -->
        <div id="bulkUploadContent" class="tab-content hidden">
            <div class="bg-white shadow-sm rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Bulk Upload Results</h3>
                </div>
                
                <div class="p-6">
                    <!-- Upload Instructions -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle text-blue-400"></i>
                            </div>
                            <div class="ml-3">
                                <h4 class="text-sm font-medium text-blue-800">Upload Instructions</h4>
                                <div class="mt-2 text-sm text-blue-700">
                                    <ul class="list-disc list-inside space-y-1">
                                        <li>Download the CSV template with the correct format</li>
                                        <li>Fill in student results with Test Score (max 30) and Exam Score (max 70)</li>
                                        <li>Upload the completed CSV file</li>
                                        <li>Review and confirm before saving</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Template Download -->
                    <div class="mb-6">
                        <h4 class="text-md font-medium text-gray-900 mb-3">Step 1: Download Template</h4>
                        <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center space-x-2">
                            <i class="fas fa-download"></i>
                            <span>Download CSV Template</span>
                        </button>
                    </div>

                    <!-- File Upload -->
                    <div class="mb-6">
                        <h4 class="text-md font-medium text-gray-900 mb-3">Step 2: Upload Completed File</h4>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors">
                            <div class="space-y-4">
                                <div class="flex justify-center">
                                    <i class="fas fa-file-csv text-4xl text-gray-400"></i>
                                </div>
                                <div>
                                    <p class="text-lg font-medium text-gray-900">Drop CSV file here</p>
                                    <p class="text-sm text-gray-500">or click to browse</p>
                                </div>
                                <input type="file" accept=".csv" class="hidden" id="csvUpload">
                                <button onclick="document.getElementById('csvUpload').click()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Choose CSV File
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Preview Section (Hidden by default) -->
                    <div id="csvPreview" class="hidden">
                        <h4 class="text-md font-medium text-gray-900 mb-3">Step 3: Preview & Confirm</h4>
                        <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <p class="text-sm font-medium text-gray-900">File: results_mathematics_10a.csv</p>
                                    <p class="text-sm text-gray-500">25 students found</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                        <i class="fas fa-check mr-2"></i>Confirm Upload
                                    </button>
                                    <button class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md text-sm font-medium">
                                        <i class="fas fa-times mr-2"></i>Cancel
                                    </button>
                                </div>
                            </div>
                            <div class="text-sm text-gray-600">
                                <p>✓ All required columns present</p>
                                <p>✓ No duplicate student records</p>
                                <p>✓ All scores within valid range</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Details Modal -->
    <div id="resultDetailsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-5/6 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex items-center justify-between pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Result Details - <span id="modalSubjectClass">Mathematics - Class 10A</span></h3>
                    <button onclick="closeResultDetails()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="py-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test (30)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Exam (70)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total (100)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grade</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Remark</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <img class="h-8 w-8 rounded-full" src="https://via.placeholder.com/32x32/3B82F6/FFFFFF?text=AS" alt="">
                                            <div class="ml-3">
                                                <div class="text-sm font-medium text-gray-900">Alice Smith</div>
                                                <div class="text-sm text-gray-500">STU001</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">28</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">62</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">90</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">A</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Excellent</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <img class="h-8 w-8 rounded-full" src="https://via.placeholder.com/32x32/10B981/FFFFFF?text=BJ" alt="">
                                            <div class="ml-3">
                                                <div class="text-sm font-medium text-gray-900">Bob Johnson</div>
                                                <div class="text-sm text-gray-500">STU002</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">25</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">58</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">83</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">B</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Good</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <img class="h-8 w-8 rounded-full" src="https://via.placeholder.com/32x32/F59E0B/FFFFFF?text=CW" alt="">
                                            <div class="ml-3">
                                                <div class="text-sm font-medium text-gray-900">Carol White</div>
                                                <div class="text-sm text-gray-500">STU003</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">22</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">53</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">75</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">C</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Credit</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end pt-4 border-t border-gray-200">
                    <button onclick="closeResultDetails()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 mr-2">Close</button>
                    <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Export Results</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active state from all tabs
            document.querySelectorAll('button[id$="Tab"]').forEach(tab => {
                tab.classList.remove('border-blue-500', 'text-blue-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab content
            document.getElementById(tabName + 'ResultsContent').classList.remove('hidden');
            
            // Add active state to selected tab
            const activeTab = document.getElementById(tabName + 'Tab');
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('border-blue-500', 'text-blue-600');
        }

        // Load students when class is selected
        function loadStudents() {
            const classSelect = document.getElementById('classSelect');
            const studentsTable = document.getElementById('studentsTable');
            
            if (classSelect.value) {
                studentsTable.classList.remove('hidden');
            } else {
                studentsTable.classList.add('hidden');
            }
        }

        // Calculate total score and grade
        function calculateTotal(input) {
            const row = input.closest('tr');
            const testScore = parseFloat(row.querySelector('input[max="30"]').value) || 0;
            const examScore = parseFloat(row.querySelector('input[max="70"]').value) || 0;
            const total = testScore + examScore;
            
            // Update total score
            row.querySelector('.total-score').textContent = total;
            
            // Calculate grade and remark
            let grade, gradeClass, remark;
            if (total >= 90) {
                grade = 'A';
                gradeClass = 'bg-green-100 text-green-800';
                remark = 'Excellent';
            } else if (total >= 80) {
                grade = 'B';
                gradeClass = 'bg-blue-100 text-blue-800';
                remark = 'Good';
            } else if (total >= 70) {
                grade = 'C';
                gradeClass = 'bg-yellow-100 text-yellow-800';
                remark = 'Credit';
            } else if (total >= 60) {
                grade = 'D';
                gradeClass = 'bg-orange-100 text-orange-800';
                remark = 'Pass';
            } else if (total >= 50) {
                grade = 'E';
                gradeClass = 'bg-red-100 text-red-800';
                remark = 'Poor';
            } else {
                grade = 'F';
                gradeClass = 'bg-red-100 text-red-800';
                remark = 'Fail';
            }
            
            // Update grade badge
            const gradeBadge = row.querySelector('.grade-badge');
            gradeBadge.textContent = grade;
            gradeBadge.className = `grade-badge inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${gradeClass}`;
            
            // Update remark
            row.querySelector('.remark').textContent = remark;
        }

        // Save results function
        function saveResults() {
            const classVal = document.getElementById('classSelect').value;
            const subjectVal = document.getElementById('subjectSelect').value;
            const termVal = document.getElementById('termSelect').value;
            const sessionVal = document.getElementById('sessionSelect').value;
            
            if (!classVal || !subjectVal || !termVal || !sessionVal) {
                alert('Please fill in all required fields (Class, Subject, Term, Session)');
                return;
            }
            
            // Here you would normally send the data to your Django backend
            alert('Results saved successfully!');
        }

        // Lock results function
        function lockResults() {
            if (confirm('Are you sure you want to lock these results? This will prevent further edits.')) {
                // Here you would normally send a lock request to your Django backend
                alert('Results locked successfully!');
            }
        }

        // View result details
        function viewResultDetails(subject, className) {
            document.getElementById('modalSubjectClass').textContent = `${subject} - Class ${className}`;
            document.getElementById('resultDetailsModal').classList.remove('hidden');
        }

        // Close result details modal
        function closeResultDetails() {
            document.getElementById('resultDetailsModal').classList.add('hidden');
        }

        // Delete result function
        function deleteResult(subject, className) {
            if (confirm(`Are you sure you want to delete results for ${subject} - Class ${className}? This action cannot be undone.`)) {
                // Here you would normally send a delete request to your Django backend
                alert('Results deleted successfully!');
                // Refresh the view or remove the card from DOM
            }
        }

        // Close modal when clicking outside
        document.getElementById('resultDetailsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeResultDetails();
            }
        });

        // CSV file upload handling
        document.getElementById('csvUpload').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                // Show preview section
                document.getElementById('csvPreview').classList.remove('hidden');
                
                // Here you would normally process the CSV file
                // For demo purposes, we're just showing the preview section
            }
        });
    </script>

{% endblock %}